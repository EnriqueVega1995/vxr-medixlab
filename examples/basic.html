<html>

<head>
  <meta charset="utf-8">
  <title>Web-XR-Gallery</title>
  <meta name="description" content="Web-XR-Gallery">

  <!-- <script src="super/build.js"></script> -->
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.slim.js"></script>
  <script src="/easyrtc/easyrtc.js"></script>
  <script src="/dist/networked-aframe.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  <script src="/js/spawn-in-circle.component.js"></script>
  <!-- RayCast -->
  <script src="js/raycast.component.js"></script>

  <script>
    // see issue https://github.com/networked-aframe/networked-aframe/issues/267
    NAF.schemas.getComponentsOriginal = NAF.schemas.getComponents;
    NAF.schemas.getComponents = (template) => {
      if (!NAF.schemas.hasTemplate("#avatar-template")) {
        NAF.schemas.add({
          template: '#avatar-template',
          components: [
            'position',
            'rotation',
            {
              selector: '.head',
              component: 'material',
              property: 'color'
            }
          ]
        });
      }
      const components = NAF.schemas.getComponentsOriginal(template);
      return components;
    }
  </script>

</head>

<body>
  <a-scene networked-scene="
      room: dev;
      debug: true;
      adapter: easyrtc;
    ">
    <a-assets>

      <img id="grid" src="https://img.gs/bbdkhfbzkk/stretch/https://i.imgur.com/25P1geh.png" crossorigin="anonymous">
      <img id="sky" src="https://i.imgur.com/WqlqEkq.jpg" crossorigin="anonymous" />
      <a-asset-item id="buy" src="Buy_Bottom.gltf"></a-asset-item>
      <a-asset-item id="patient" src="Patient_VesicalMale.gltf"></a-asset-item>
      <a-asset-item id="gallery" src="WebGallety.gltf"></a-asset-item>
      <a-asset-item id="Egg" src="Egg.gltf"></a-asset-item>
      <a-asset-item id="BadChicken" src="BadChicken.gltf"></a-asset-item>

      <!-- Templates -->

      <!-- Avatar -->
      <template id="avatar-template">
        <a-entity class="avatar">
          <a-sphere class="head" scale="0.45 0.5 0.4"></a-sphere>
          <a-entity class="face" position="0 0.05 0">
            <a-sphere class="eye" color="#efefef" position="0.16 0.1 -0.35" scale="0.12 0.12 0.12">
              <a-sphere class="pupil" color="#000" position="0 0 -1" scale="0.2 0.2 0.2"></a-sphere>
            </a-sphere>
            <a-sphere class="eye" color="#efefef" position="-0.16 0.1 -0.35" scale="0.12 0.12 0.12">
              <a-sphere class="pupil" color="#000" position="0 0 -1" scale="0.2 0.2 0.2"></a-sphere>
            </a-sphere>
          </a-entity>
        </a-entity>
      </template>

      <!-- /Templates -->
    </a-assets>

    <a-entity id="player" networked="template:#avatar-template;attachTemplateToLocal:false;" camera="fov:35" scroll
      position="0 2.8 3" rotation="0 0 0">

      <a-entity light="type: point;  distance: 10;  color: #f22; intensity:1; decay: 0.05" position="0 0 0"></a-entity>
      <a-sphere class="head" visible="false" random-color></a-sphere>
      <a-entity id="mouseCursor" cursor="rayOrigin: mouse" raycaster="objects: .clickable"></a-entity>
    </a-entity>
    <!-- lights -->
    <!-- <a-entity light="color: #ccccff; intensity: 1; type: ambient;" visible=""></a-entity> -->

    <a-entity id="ambientLight" light="type: ambient; color: #CCC"></a-entity>
    <a-entity id="keyLight" light="type: directional; color: #fef; intensity: 1" position="0.55717 2.48596 1.39464">
    </a-entity>
    <a-entity id="fillLight" light="type: directional; color: #efe; intensity:1" position="-1.46187 -0.55901 0.23332">
    </a-entity>



    <!-- <a-entity light="color: #ffaaff; intensity: 1.5" position="5 5 5"></a-entity> -->
    <a-sky src="#sky" rotation="0 -90 0"></a-sky>

    <a-entity class="clickable" id="gallery" gltf-model="#gallery" scale="1 1 1" position="0 1.5 0" gltf-hover
      onmouseover="hoverElement(event)"></a-entity>
    <a-entity class="clickable" id="e-Egg" gltf-model="#Egg" scale="1 1 1" position="-0.351 1.938 0"></a-entity>
    <a-entity class="clickable" id="e-BadChicken" gltf-model="#BadChicken" scale="1 1 1" position="0 1.938 0">
    </a-entity>

    </a-entity>
  </a-scene>

  <script>
    // On mobile remove elements that are resource heavy
    var isMobile = AFRAME.utils.device.isMobile();
  </script>

  <script>
    // Called by Networked-Aframe when connected to server
    function onConnect() {
      console.log("onConnect", new Date());
    }






    // function leftTransition(event) {

    //   var offset = event.deltaY;
    //   console.log("offset", offset)
    //   let camera = document.getElementById("player")
    //   const cameraVector = new THREE.Vector3(0, 0, 0);
    //   cameraVector.copy(camera.getAttribute("position"))
    //   cameraVector.y = cameraVector.y + (offset * 0.001)
    //   if(cameraVector.y<0.2 ){
    //     cameraVector.y=0.2
    //   }else if ( cameraVector.y>= 2.8 ){
    //     cameraVector.y=2.8
    //   }

    //   document.getElementById("player").setAttribute("position", cameraVector)
    // }

    function lerp(x, y, t) {

      return (1 - t) * x + t * y;

    }



    AFRAME.registerComponent('scroll', {
      schema: { default: 1.0 },
      init: function () {
        let self = this
        self.scrollY = document.getElementById("player").getAttribute("position").y
        console.log("y position: ", scrollY)



        window.addEventListener("wheel", function () {


          let offset = event.deltaY;
          console.log("offset", offset)
          self.scrollY += offset * 0.001
          console.log("self.scrollY", self.scrollY)


        });


      },
      update: function () {

      },

      tick: function (time, dt) {
        // console.log("dt: ", dt)
        // console.log("time: ", time)
        let curScroll = this.el.getAttribute("position")
        curScroll.y = lerp(curScroll.y, this.scrollY, (1 - Math.exp( - 0.005 * dt )) )
        this.el.setAttribute("position", curScroll)
        if(curScroll.y>2.8){
          this.scrollY = lerp(curScroll.y, 2.8, (1 - Math.exp( - 0.02 * dt )) )
          this.el.setAttribute("position", curScroll)
        }
        
        
        if(curScroll.y<0.7){
          this.scrollY = lerp(curScroll.y, 0.7, (1 - Math.exp( - 0.02 * dt )) )
          this.el.setAttribute("position", curScroll)
        }
    

      }
    });




  </script>
</body>

</html>